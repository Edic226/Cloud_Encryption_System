from SM import SM2
from SM import SM9
from SM import SM3
from SM import SM9

mk = (([10857046999023057135944570762232829481370756359578518086990519993285655852781,
            11559732032986387107991004021392285783925812861821192530917403151452391805634],
           [8495653923123431417604973247489272438418190587263600148770280649306958101930,
            4082367875863433681332203403145435568316851327593401208105741076214120093531], [1, 0]), (1, 2, 1), (
          962409270692906665210497985413989704088720419309240615841368990023997216812,
          3271581871419785851668579019734310847216340692063108518506367024373266193080,
          18304055564673556129558499187660942613405293183050823021561530679809577054750),
          [12864935809406530183584304405851160175667039392258496330691647811497774067966,
           7671855242883030625702626367573241181399904276705224870982398885438093219978,
           19892112364475781574564217588139883697418629755269037369977109364281686357441,
           11055964186984541202456906089170873840264815486362552431889020299866018819837,
           21026077087415008328773591346915115192124874979089066696296397179397458561250,
           19711074527443996329451729216430630520892171955136537951685764103141776985295,
           3417147333254890389950332865898426053600691534567759795846152213046589114775,
           12027133373727411513126348199328180361257751009808339923352908838272183974675,
           11754746869443985818342443022268864735769904962059524303661028661681260002184,
           21005887229246336758210326878113100826700178637445813813063758813503119548863,
           4765904765895042370241401283823761831087544913906074352223180329566547445076,
           9104519774161028272206245001373125648326128992926511600907081194312425859064])
master_public = SM9.get_master_public(mk)
master_secret = 724898525711316440692027036366274753928939329665328187567054993041654584178
test = 'ABCDEFG'
id = 'Edic123'
if __name__ == '__main__':
    sign = SM9.sm9_sign(master_public, master_secret, id, test)
    print(sign)
    with open('test.txt', 'w') as f:
        f.write('test' + sign)
    with open('test.txt', 'r') as f:
        s = f.read()
    signature, data = SM9.get_sign(s)
    verify = SM9.sm9_verify(master_public, id, test, signature)
    print(verify)


'''
master_public = (
    ([10857046999023057135944570762232829481370756359578518086990519993285655852781,
       11559732032986387107991004021392285783925812861821192530917403151452391805634],
      [8495653923123431417604973247489272438418190587263600148770280649306958101930,
       4082367875863433681332203403145435568316851327593401208105741076214120093531], [1, 0]), (1, 2, 1), (
     19477484887725027935972210044143875708397076953992454525762910185235805801443,
     14757305912178116659467007895564801264755907066828376584467457637841610724414,
     13003020872612451023808307571450864126175948705276033815968899719237098794080),
     [3884602216201078069630361675541923680591737021131869723285963097667163380217,
      21197882888019206972814592841336469795236306971952770611945673483290654061662,
      16230026804200918959303081989080666100865493451828809545229031638064865028054,
      2608689708702694102159054117102907709491365966681055536013436898581875431260,
      16353762512419113411851739846211301219905475871888868012123770803088260104681,
      15036721179240988393668778499487486696673399825958125154876071686376026324338,
      18618477904619625469397386549771911392577025476234543658505991312899759691389,
      11317970810560663294574119059769103517643653465908842439270080226952073507444,
      19817324926533498093479154513527583021690925492272264274586203369488533152268,
      11561588656198888677806230436333621383125192813687109350373700196664735887142,
      14388571025755445904557439289307837902376100187541461500117867110600186417367,
      21745347068317899845787992038416449260894508886383871037129212936293817872135]
)

master_secret = 7062766645146975291771959750943502123342816173507249613600988505100087011445
'''

'''name_h = SM3.sm3_hash(name)
            # 打开特定的文件进行二进制的写操作;
            with open("./tmp/%s" % File.name, 'wb+') as f:
                # 分块写入文件;
                sk, pk = SM2.sm2_getkey()
                for chunk in File.chunks():
                    en = SM2.sm2_encryt(chunk, pk)
                    f.write(en)
            with open("./tmp/%s" % File.name, 'rb') as f:
                s = f.read()
                print(s)
                print(SM2.sm2_decryt(s, sk))
            return HttpResponse("upload over!")'''
